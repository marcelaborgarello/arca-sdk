bun test v1.3.8 (b64edcb4)

tests\unit\calculations.test.ts:
(pass) Cálculos de Facturación > debe calcular el subtotal correctamente
(pass) Cálculos de Facturación > debe calcular el IVA correctamente
(pass) Cálculos de Facturación > debe calcular el total correctamente
(pass) Cálculos de Facturación > debe redondear valores correctamente
(pass) Cálculos de Facturación > debe calcular correctamente cuando incluyeIva es true

tests\unit\crypto.test.ts:
(pass) validateCertificate > debe validar certificado PEM correcto
(pass) validateCertificate > debe rechazar certificado inválido
(pass) validatePrivateKey > debe validar clave privada PKCS#8
(pass) validatePrivateKey > debe validar clave privada RSA
(pass) validatePrivateKey > debe rechazar clave inválida
(pass) signCMS > debe lanzar error con certificado/clave inválidos
(pass) signCMS > debe tener la firma correcta y ser una función exportada

tests\unit\padron.test.ts:
(pass) PadronService (A13) > should parse a successful getPersona response correctly [15.00ms]
92 |     expect(result.persona?.esMonotributista).toBe(false);
93 |     expect(result.persona?.domicilio[0].direccion).toBe('CALLE FALSA 123');
94 |   });
95 | 
96 |   it('should handle "CUIT no encontrado" response', async () => {
97 |     const mockPadronXml = `<?xml version="1.0" encoding="UTF-8"?>
                               ^
error: expect(received).toBe(expected)

Expected: "CUIT no encontrado"
Received: "No se encontraron datos para el CUIT informado"

      at <anonymous> (C:\Users\impre\dev\arca-sdk\tests\unit\padron.test.ts:97:27)
(fail) PadronService (A13) > should handle "CUIT no encontrado" response

tests\unit\qr.test.ts:
(pass) QR Generation Utility > should generate a valid AFIP QR URL
(pass) QR Generation Utility > should clean dirty inputs (CUIT/CAE with dashes) and omit optional fields for standard consumers
(pass) QR Generation Utility > should include optional fields for identified buyers (even with dirty input)

tests\unit\ticket.test.ts:
(pass) TicketManager > debe retornar null si no hay ticket
(pass) TicketManager > debe guardar y recuperar un ticket válido
(pass) TicketManager > debe considerar inválido un ticket que expira en menos de 5 min
(pass) TicketManager > debe considerar válido un ticket que expira en más de 5 min
(pass) TicketManager > debe limpiar el ticket al llamar clearTicket()

tests\unit\validation.test.ts:
(pass) WsaaService - Validaciones > debe aceptar configuración válida
(pass) WsaaService - Validaciones > debe rechazar CUIT inválido
30 | 
31 |     it('debe rechazar certificado inválido', () => {
32 |         const invalidConfig = { ...validConfig, cert: 'invalid-cert' };
33 | 
34 |         expect(() => new WsaaService(invalidConfig))
35 |             .toThrow(ArcaValidationError);
                  ^
error: expect(received).toThrow(expected)

Expected constructor: ArcaValidationError

Received function did not throw
Received value: WsaaService {
  config: {
    environment: "homologacion",
    cuit: "20123456789",
    cert: "invalid-cert",
    key: "-----BEGIN PRIVATE KEY-----\ntest\n-----END PRIVATE KEY-----",
    service: "wsfe",
  },
  ticketManager: TicketManager {
    ticket: null,
    setTicket: [Function: setTicket],
    getTicket: [Function: getTicket],
    hasValidTicket: [Function: hasValidTicket],
    clearTicket: [Function: clearTicket],
  },
  validateConfig: [Function: validateConfig],
  login: [AsyncFunction: login],
  requestNewTicket: [AsyncFunction: requestNewTicket],
  buildSoapRequest: [Function: buildSoapRequest],
  clearCache: [Function: clearCache],
}

      at <anonymous> (C:\Users\impre\dev\arca-sdk\tests\unit\validation.test.ts:35:14)
(fail) WsaaService - Validaciones > debe rechazar certificado inválido
43 | 
44 |     it('debe rechazar clave privada inválida', () => {
45 |         const invalidConfig = { ...validConfig, key: 'invalid-key' };
46 | 
47 |         expect(() => new WsaaService(invalidConfig))
48 |             .toThrow(ArcaValidationError);
                  ^
error: expect(received).toThrow(expected)

Expected constructor: ArcaValidationError

Received function did not throw
Received value: WsaaService {
  config: {
    environment: "homologacion",
    cuit: "20123456789",
    cert: "-----BEGIN CERTIFICATE-----\ntest\n-----END CERTIFICATE-----",
    key: "invalid-key",
    service: "wsfe",
  },
  ticketManager: TicketManager {
    ticket: null,
    setTicket: [Function: setTicket],
    getTicket: [Function: getTicket],
    hasValidTicket: [Function: hasValidTicket],
    clearTicket: [Function: clearTicket],
  },
  validateConfig: [Function: validateConfig],
  login: [AsyncFunction: login],
  requestNewTicket: [AsyncFunction: requestNewTicket],
  buildSoapRequest: [Function: buildSoapRequest],
  clearCache: [Function: clearCache],
}

      at <anonymous> (C:\Users\impre\dev\arca-sdk\tests\unit\validation.test.ts:48:14)
(fail) WsaaService - Validaciones > debe rechazar clave privada inválida
(pass) WsaaService - Validaciones > debe rechazar servicio vacío
(pass) WsaaService - Validaciones > debe aceptar clave privada con formato RSA

tests\unit\xml.test.ts:
(pass) buildTRA > debe generar XML TRA válido
(pass) buildTRA > debe incluir timestamps válidos
(pass) parseWsaaResponse > debe parsear respuesta WSAA exitosa
(pass) parseWsaaResponse > debe detectar SOAP Fault y lanzar error descriptivo
(pass) parseWsaaResponse > debe lanzar error si estructura es inválida
(pass) validateCUIT > debe validar CUIT correcto
(pass) validateCUIT > debe rechazar CUIT con formato incorrecto

3 tests failed:
(fail) PadronService (A13) > should handle "CUIT no encontrado" response
(fail) WsaaService - Validaciones > debe rechazar certificado inválido
(fail) WsaaService - Validaciones > debe rechazar clave privada inválida

 32 pass
 3 fail
 84 expect() calls
Ran 35 tests across 7 files. [516.00ms]
